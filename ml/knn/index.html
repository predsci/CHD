


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Python routines and documentation for the PSI Coronal Hole Detection Project.">
      
      
      
        <meta name="author" content="Tamar Ervin">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.4.0">
    
    
      
        <title>KNN - Coronal Hole Detection Project</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.fe0cca5b.min.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/palette.a46bcfb3.min.css">
      
      
        
        
        <meta name="theme-color" content="#3f51b5">
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="indigo" data-md-color-accent="black">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#how-to-match-coronal-holes-between-sequential-frames" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../.." title="Coronal Hole Detection Project" class="md-header-nav__button md-logo" aria-label="Coronal Hole Detection Project">
      
  <img src="../../img/psi_logo.png" alt="logo">

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Coronal Hole Detection Project
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              KNN
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/predsci/CHD/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Coronal Hole Detection Project" class="md-nav__button md-logo" aria-label="Coronal Hole Detection Project">
      
  <img src="../../img/psi_logo.png" alt="logo">

    </a>
    Coronal Hole Detection Project
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/predsci/CHD/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../about/" title="About the Project" class="md-nav__link">
      About the Project
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Image Pre-Processing
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Image Pre-Processing" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Image Pre-Processing
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../ipp/psf/" title="PSF Deconvolution" class="md-nav__link">
      PSF Deconvolution
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ipp/lbc/" title="Limb-Brightening Correction" class="md-nav__link">
      Limb-Brightening Correction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ipp/iit/" title="Inter-Instrument Transformation" class="md-nav__link">
      Inter-Instrument Transformation
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Coronal Hole Detection
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Coronal Hole Detection" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Coronal Hole Detection
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../chd/f2py/" title="Fortran to Python" class="md-nav__link">
      Fortran to Python
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chd/chd/" title="CH Detection" class="md-nav__link">
      CH Detection
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Mapping
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Mapping" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Mapping
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../map/map/" title="Mapping Pipeline" class="md-nav__link">
      Mapping Pipeline
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../map/int/" title="Interpolation" class="md-nav__link">
      Interpolation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../map/cmb/" title="Combining Maps" class="md-nav__link">
      Combining Maps
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Data Products
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Data Products" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Data Products
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../dp/cr/" title="Synoptic Maps" class="md-nav__link">
      Synoptic Maps
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../dp/qm/" title="Quality Maps" class="md-nav__link">
      Quality Maps
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../dp/ed/" title="Ensemble Detection" class="md-nav__link">
      Ensemble Detection
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../dp/vt/" title="Varying Threshold Maps" class="md-nav__link">
      Varying Threshold Maps
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Database
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Database" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Database
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../db/db/" title="Database Basics" class="md-nav__link">
      Database Basics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../db/lbc/" title="Database for LBC" class="md-nav__link">
      Database for LBC
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../db/iit/" title="Database for IIT" class="md-nav__link">
      Database for IIT
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../db/map/" title="Database for CHD Mapping" class="md-nav__link">
      Database for CHD Mapping
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8" checked>
    
    <label class="md-nav__link" for="nav-8">
      Tracking Algorithm
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Tracking Algorithm" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Tracking Algorithm
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../tracking_overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../polarprojection/" title="Polar Projection" class="md-nav__link">
      Polar Projection
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../latitude_weighted_dilation/" title="Latitude Weighted Dilation" class="md-nav__link">
      Latitude Weighted Dilation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tracking_features/" title="CH Features" class="md-nav__link">
      CH Features
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8-5" type="checkbox" id="nav-8-5" checked>
    
    <label class="md-nav__link" for="nav-8-5">
      CH Frame Matching
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="CH Frame Matching" data-md-level="2">
      <label class="md-nav__title" for="nav-8-5">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        CH Frame Matching
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../match_overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        KNN
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg>
        </span>
      </label>
    
    <a href="./" title="KNN" class="md-nav__link md-nav__link--active">
      KNN
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#k-nearest-neighbor-algorithm" class="md-nav__link">
    K - Nearest Neighbor Algorithm
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#knn-settings" class="md-nav__link">
    KNN settings
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-of-knn-classification" class="md-nav__link">
    Example of KNN classification
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-weighted-k-nearest-neighbor-classifier" class="md-nav__link">
    1. Weighted K-Nearest Neighbor Classifier
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-distance-metric" class="md-nav__link">
    2. Distance Metric
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-probability-estimate" class="md-nav__link">
    3. Probability Estimate
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-how-do-we-choose-the-optimal-k" class="md-nav__link">
    4. How do we choose the optimal K?
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../areaoverlap/" title="Area Overlap" class="md-nav__link">
      Area Overlap
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../connectivity/" title="CH Connectivity" class="md-nav__link">
      CH Connectivity
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Machine Learning Detection
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Machine Learning Detection" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Machine Learning Detection
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../chd/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../kmeans/" title="K-Means Detection" class="md-nav__link">
      K-Means Detection
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../pred/" title="CH-Net Future Frame Predictions" class="md-nav__link">
      CH-Net Future Frame Predictions
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#k-nearest-neighbor-algorithm" class="md-nav__link">
    K - Nearest Neighbor Algorithm
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#knn-settings" class="md-nav__link">
    KNN settings
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-of-knn-classification" class="md-nav__link">
    Example of KNN classification
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-weighted-k-nearest-neighbor-classifier" class="md-nav__link">
    1. Weighted K-Nearest Neighbor Classifier
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-distance-metric" class="md-nav__link">
    2. Distance Metric
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-probability-estimate" class="md-nav__link">
    3. Probability Estimate
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-how-do-we-choose-the-optimal-k" class="md-nav__link">
    4. How do we choose the optimal K?
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/predsci/CHD/blob/master/CHD-mkdocs/docs/ml/knn.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  
                
                
                <h1 id="how-to-match-coronal-holes-between-sequential-frames">How to match coronal holes between sequential frames?</h1>
<h2 id="k-nearest-neighbor-algorithm">K - Nearest Neighbor Algorithm</h2>
<p>KNN algorithm is a simple supervised machine learning algorithm that is used to solve classification problems. 
KNN is easy to implement and understand. Classification is based on proximity. Here, we will use the coronal 
hole centroid location in spherical coordinates to classify its ID number based on previously identified coronal holes.  </p>
<h2 id="knn-settings">KNN settings</h2>
<p>Lets assume we have the following pairs <span><span class="MathJax_Preview">(X_{1}, Y_{1}), (X_{2}, Y_{2}), ..., (X_{n}, Y_{n})</span><script type="math/tex">(X_{1}, Y_{1}), (X_{2}, Y_{2}), ..., (X_{n}, Y_{n})</script></span>,
 each pair has a label <span><span class="MathJax_Preview">(L_{m})</span><script type="math/tex">(L_{m})</script></span>, where <span><span class="MathJax_Preview">m</span><script type="math/tex">m</script></span> indicates the class associated with the pair. 
The pairs and labeled coronal holes are treated as the <em>training dataset</em>. 
Then, given a new unlabled pair <span><span class="MathJax_Preview">(X_{n+1}, Y_{n+1})</span><script type="math/tex">(X_{n+1}, Y_{n+1})</script></span>, we classify its associated label by its proximity to 
the pairs in the <em>training dataset</em>. K indicates the number of adjacent pairs near the new unlabled point <span><span class="MathJax_Preview">(X_{n+1}, Y_{n+1})</span><script type="math/tex">(X_{n+1}, Y_{n+1})</script></span>. Therefore, 
K is a <em>hyper-parameter</em>. Based on the nearest K points one can compute the probability associated with each class. 
Then, based on a threshold (<span><span class="MathJax_Preview">\xi</span><script type="math/tex">\xi</script></span>), the coronal hole can be labeled as an existing coronal hole in the library or be introduced
as a new coronal hole.</p>
<h2 id="example-of-knn-classification">Example of KNN classification</h2>
<p><img alt="" src="../images/KnnClassification.svg" /></p>
<p>The test sample (green circle) should be classified either to red triangle or blue square. </p>
<ul>
<li>
<p><strong>Case 1</strong>: If K = 3 (solid line circle) then it is 75% red and 25% being blue. 
Based on the threshold (<span><span class="MathJax_Preview">\xi</span><script type="math/tex">\xi</script></span>) we will either classify the new coronal hole as red or as a new coronal hole. </p>
</li>
<li>
<p><strong>Case 2</strong>: If K = 5 (dashed circle) then the new coronal hole is 60% blue and 40% red. 
Therefore, in this case when k=5, the new coronal hole will be classified as blue or as a new coronal hole. 
It is important to mention that since the location of the centroid is placed on a sphere, we will use the <em>haversine</em>
metric to compute the distance between any two centroids. The <em>haversine</em> metric is defined as follows</p>
</li>
</ul>
<div>
<div class="MathJax_Preview">
d = 2 r \arcsin(\sqrt{\sin^{2}((\theta_{1} - \theta_{2})/2) + \cos(\theta_{1})\cos(\theta_{2})\sin^{2}((\phi_{2} - \phi_{1})/2))} )
</div>
<script type="math/tex; mode=display">
d = 2 r \arcsin(\sqrt{\sin^{2}((\theta_{1} - \theta_{2})/2) + \cos(\theta_{1})\cos(\theta_{2})\sin^{2}((\phi_{2} - \phi_{1})/2))} )
</script>
</div>
<h2 id="1-weighted-k-nearest-neighbor-classifier">1. Weighted K-Nearest Neighbor Classifier</h2>
<p>The coronal holes identified in the previous frame will have a larger <strong>weight</strong> than the coronal holes found in the previous 
say 5th frame. The total training data will be composed of the previous 10 frames (this number can be changed as we test it on the images). 
Hence, the weight of each coronal hole would be based on its frame number. </p>
<div>
<div class="MathJax_Preview"> W_{1}(n) = \frac{1}{n_{last} - n}</div>
<script type="math/tex; mode=display"> W_{1}(n) = \frac{1}{n_{last} - n}</script>
</div>
<p>Therefore, the weight of the coronal hole is proportional to its frame number. </p>
<ul>
<li>We also want to define the weight based on distance? Thoughts?</li>
</ul>
<div>
<div class="MathJax_Preview"> W_{2}(d) = 1/d</div>
<script type="math/tex; mode=display"> W_{2}(d) = 1/d</script>
</div>
<p>Therefore the weight can be some type of combination of the two weights. </p>
<div>
<div class="MathJax_Preview">W_{final} = W_{1} W_{2}</div>
<script type="math/tex; mode=display">W_{final} = W_{1} W_{2}</script>
</div>
<h2 id="2-distance-metric">2. Distance Metric</h2>
<p>As explained above we will use the <em>haversine</em> function. That will also overcome the issue of periodicity.<br />
Note: "haversine" in sklearn metric requires data in the form of [latitude, longitude] and both inputs and outputs are in units of radians.</p>
<h2 id="3-probability-estimate">3. Probability Estimate</h2>
<p><img alt="" src="../images/KNNclassifier.png" /></p>
<p>The <em>training</em> dataset: </p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="k">c</span><span class="o">#</span> <span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span>            <span class="k">class</span>
<span class="o">================================</span>

<span class="mi">0</span> <span class="p">[</span><span class="mi">3</span><span class="p">.</span>  <span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="p">]</span>                 <span class="n">red</span>

<span class="mi">1</span> <span class="p">[</span><span class="mi">3</span><span class="p">.</span> <span class="mi">2</span><span class="p">.]</span>                   <span class="n">red</span>

<span class="mi">2</span> <span class="p">[</span><span class="mi">3</span><span class="p">.</span><span class="mi">2</span> <span class="mi">1</span><span class="p">.</span> <span class="p">]</span>                 <span class="n">red</span>

<span class="mi">3</span> <span class="p">[</span><span class="mi">6</span><span class="p">.</span> <span class="mi">2</span><span class="p">.</span><span class="mi">64</span><span class="p">]</span>                 <span class="n">blue</span>

<span class="mi">4</span> <span class="p">[</span><span class="mi">5</span><span class="p">.</span><span class="mi">28</span> <span class="mi">2</span><span class="p">.</span><span class="mi">5</span><span class="p">]</span>                <span class="n">blue</span>

<span class="mi">5</span> <span class="p">[</span><span class="mi">6</span><span class="p">.</span><span class="mi">18</span>  <span class="mi">3</span><span class="p">.]</span>                <span class="n">blue</span>

<span class="o">?</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>               <span class="k">TO</span> <span class="n">BE</span> <span class="n">COMPUTED</span>
</code></pre></div>
</td></tr></table>

<p><img alt="" src="../images/KNNclassifier3D.png" /></p>
<p>Lets compute the distance between [4, 1] and all the 6 centroids in the library (K=6). </p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="n">d</span>       <span class="k">c</span><span class="o">#</span>      <span class="k">class</span>

<span class="mi">2</span>       <span class="mi">0</span><span class="p">.</span><span class="mi">423</span>    <span class="n">red</span>

<span class="mi">1</span>       <span class="mi">0</span><span class="p">.</span><span class="mi">871</span>    <span class="n">red</span>

<span class="mi">3</span>       <span class="mi">0</span><span class="p">.</span><span class="mi">926</span>    <span class="n">blue</span>

<span class="mi">4</span>       <span class="mi">0</span><span class="p">.</span><span class="mi">988</span>    <span class="n">blue</span>

<span class="mi">5</span>       <span class="mi">1</span><span class="p">.</span><span class="mi">131</span>    <span class="n">blue</span>

<span class="mi">0</span>       <span class="mi">1</span><span class="p">.</span><span class="mi">18</span>     <span class="n">red</span>
</code></pre></div>
</td></tr></table>

<p>Compute the weighted sum probability based on distance. </p>
<div>
<div class="MathJax_Preview">
W(X) = [1/1.18, 1/0.871, 1/0.423, 1/0.926, 1/0.988, 1/1.131]
</div>
<script type="math/tex; mode=display">
W(X) = [1/1.18, 1/0.871, 1/0.423, 1/0.926, 1/0.988, 1/1.131]
</script>
</div>
<div>
<div class="MathJax_Preview">
T_{red} = 1/1.18 + 1/0.871 + 1/0.423 = 4.359
</div>
<script type="math/tex; mode=display">
T_{red} = 1/1.18 + 1/0.871 + 1/0.423 = 4.359
</script>
</div>
<div>
<div class="MathJax_Preview">
T_{blue} = 1/0.926 + 1/0.988 + 1/1.131 = 2.976
</div>
<script type="math/tex; mode=display">
T_{blue} = 1/0.926 + 1/0.988 + 1/1.131 = 2.976
</script>
</div>
<div>
<div class="MathJax_Preview">
P_{red} = \frac{T_{red}}{T_{red} + T_{blue}} = 0.594
</div>
<script type="math/tex; mode=display">
P_{red} = \frac{T_{red}}{T_{red} + T_{blue}} = 0.594
</script>
</div>
<div>
<div class="MathJax_Preview">
P_{blue} = \frac{T_{blue}}{T_{red} + T_{blue}} = 0.405
</div>
<script type="math/tex; mode=display">
P_{blue} = \frac{T_{blue}}{T_{red} + T_{blue}} = 0.405
</script>
</div>
<p>Predicted probability of [4, 1] is as follows:</p>
<p>0.594 and 0.405 for class red and blue respectively. Since <span><span class="MathJax_Preview">P_{red} &gt; P_{blue}</span><script type="math/tex">P_{red} > P_{blue}</script></span> then it is more 
likely [4, 1] is of class red, yet the probability is close to 50/50 therefore we should set a threshold to classify such cases to be 
new coronal holes. </p>
<h2 id="4-how-do-we-choose-the-optimal-k">4. How do we choose the optimal K?</h2>
<p>The default K is 5. If we have few frames or total coronal holes in the library we should alter this number. 
* Note: small perturbations in K will not effect the solution of the WKNN algorithm. </p>
<h1 id="implementation-steps-in-python">Implementation steps in Python</h1>
<p><em>sklearn</em> library implemented KNN algorithm is called <em>KNeighborsClassifier()</em>. </p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsClassifier</span>
</code></pre></div>
</td></tr></table>

<h3 id="step-1">Step 1</h3>
<p>Prepare the <em>training</em> dataset. This information is saved in Coronal Hole DB. Access the latest five frames centroid location 
<span><span class="MathJax_Preview">(\phi, \theta)</span><script type="math/tex">(\phi, \theta)</script></span> and corresponding frame number. Organize this information in the following form:</p>
<div>
<div class="MathJax_Preview">
X = [[\phi_{1}, \theta_{1}], [\phi_{2}, \theta_{2}], ... [\phi_{n}, \theta_{n}]]
</div>
<script type="math/tex; mode=display">
X = [[\phi_{1}, \theta_{1}], [\phi_{2}, \theta_{2}], ... [\phi_{n}, \theta_{n}]]
</script>
</div>
<div>
<div class="MathJax_Preview">
Y = [ID_{1}, ID_{2}, .... ID_{n}]
</div>
<script type="math/tex; mode=display">
Y = [ID_{1}, ID_{2}, .... ID_{n}]
</script>
</div>
<div>
<div class="MathJax_Preview">
F = [f_{1}, f_{2}, .... , f_{n}]
</div>
<script type="math/tex; mode=display">
F = [f_{1}, f_{2}, .... , f_{n}]
</script>
</div>
<p>Where <span><span class="MathJax_Preview">X</span><script type="math/tex">X</script></span> is the centroid location in longitude and latitude (radians), <span><span class="MathJax_Preview">Y</span><script type="math/tex">Y</script></span> is the corresponding ID number, and 
<span><span class="MathJax_Preview">F</span><script type="math/tex">F</script></span> is the frame number. </p>
<h3 id="step-2">Step 2</h3>
<p>Use the built in sklearn KNN algorithm to find the distance between the K- nearest neighbors. See Jupyter Notebook for 
a quick tutorial explaining the code below. </p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="o">#</span><span class="n">sklearn</span> <span class="n">classified</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">clf</span> <span class="o">=</span> <span class="n">KNeighborsClassifier</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="n">vincenty</span><span class="o">/</span><span class="n">haversine</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span> <span class="o">#</span> <span class="n">fit</span> <span class="n">the</span> <span class="n">training</span> <span class="k">data</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">clf</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span> <span class="o">#</span> <span class="n">find</span> <span class="n">the</span> <span class="n">distance</span> <span class="k">between</span> <span class="n">the</span> <span class="n">k</span> <span class="n">nearest</span> <span class="n">centroids</span> <span class="k">to</span> <span class="n">the</span> <span class="k">new</span> <span class="n">coronal</span> <span class="n">hole</span><span class="p">.</span> 
<span class="o">&gt;&gt;&gt;</span> <span class="n">clf</span><span class="p">.</span><span class="n">kneighbors</span><span class="p">([[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
<span class="p">(</span><span class="nb">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">.</span><span class="mi">42397562</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">87152123</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">92636638</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">98801916</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">13048736</span><span class="p">,</span>
     <span class="mi">1</span><span class="p">.</span><span class="mi">18696572</span><span class="p">]]),</span>
 <span class="nb">array</span><span class="p">([[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]))</span>

<span class="o">&gt;&gt;&gt;</span> <span class="o">#</span> <span class="n">compute</span> <span class="n">weighted</span> <span class="n">probability</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">def</span> <span class="n">weight</span><span class="p">(</span><span class="n">ch</span><span class="p">,</span> <span class="n">last_frame_num</span><span class="p">):</span>
       <span class="k">return</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">last_frame_num</span> <span class="o">-</span> <span class="n">ch</span><span class="p">.</span><span class="n">frame_num</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span> <span class="o">#</span> <span class="n">based</span> <span class="k">on</span> <span class="n">a</span> <span class="n">threshold</span> <span class="n">decide</span> <span class="k">if</span> <span class="n">it</span> <span class="n">should</span> <span class="n">be</span> <span class="n">classified</span> <span class="k">as</span> <span class="n">an</span> <span class="k">existing</span> <span class="n">coronal</span> 
        <span class="n">hole</span> <span class="k">or</span> <span class="n">a</span> <span class="k">new</span> <span class="n">coronal</span> <span class="n">hole</span> <span class="k">in</span> <span class="k">database</span><span class="p">.</span>
</code></pre></div>
</td></tr></table>

<h3 id="step-3">Step 3</h3>
<p>Update the database with new classification. </p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../match_overview/" title="Overview" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Overview
              </div>
            </div>
          </a>
        
        
          <a href="../areaoverlap/" title="Area Overlap" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Area Overlap
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.d710d30a.min.js"></script>
      <script src="../../assets/javascripts/bundle.b39636ac.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: [],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.a68abb33.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
        <script src="../../javascripts/config.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>